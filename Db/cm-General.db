record (bi, "CM-Ctrl:s7-status") {
  field (DTYP, "S7plc stat")
  field (INP,  "@PLC:CM")
  field (SCAN, "I/O Intr")
  field (ZNAM, "disconnected")
  field (ONAM, "connected")
  field (ZSV,  "MAJOR")
  field (FLNK, "CM-Ctrl:s7-status-counter")
}

record (bi, "CM-Ctrl:opMode:sLocal") {
  field (DTYP, "S7plc")
  field (INP,  "@PLC:CM/0 T=BYTE B=0")
  field (PINI, "YES")
  field (PHAS, "0")
  field (ONAM,  "Local")
  field (ZNAM,  "Remote")
  field (OSV, MINOR)
  field (SCAN, "I/O Intr")
}

record (bo, "CM-Ctrl:opMode:cmdLocal") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:CM/0 T=BYTE B=0")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdLocal")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field(UDFS, "NO_ALARM")
}
record (bo, "CM-Ctrl:opMode:cmdRemote") {
  field (DTYP, "S7plc")
  field (OUT, "@PLC:CM/0 T=BYTE B=1")
  field (ZNAM, "Iddle")
  field (ONAM, "CmdRemote")
  field (PINI, "NO")
  field (HIGH, "0.5")
  field(UDFS, "NO_ALARM")
}

record (calc, "CM-Ctrl:s7-status-counter")
{
   field (INPA, "CM-Ctrl:s7-status-counter")
   field (CALC, "A+1")
   field (FLNK, "CM-Ctrl:s7-disconnect-counter")
}

record (calc, "CM-Ctrl:s7-disconnect-counter")
{
   field (INPA, "CM-Ctrl:s7-status")
   field (INPB, "CM-Ctrl:s7-disconnect-counter.LA")
   field (INPC, "CM-Ctrl:s7-disconnect-counter")
   field (CALC, "(A=0&&B=1)?C+1:C")
}


record(bo, "CM-Ctrl:Archiving:On") {
  field(DESC, "Turn CM archiving on or off")
  field(ZNAM, "Archiving off")
  field(ONAM, "Archiving on")
  field(ZSV, "MINOR")
  field(PINI, "YES")
}

record(ai, "CM-test0:sRdV") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/4 T=FLOAT")
  field(PREC, "6")
  field(SCAN, "I/O Intr")
  field(PINI, "YES")
}

#######################################################
#
# Binary input/output data
#

record(bo, "CM-Ctrl:opMode:cmdAutoMode") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/0 T=BYTE B=2")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Set Auto Mode")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:opMode:cmdManMode") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/0 T=BYTE B=3")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Set Manual Mode")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bi, "CM-Ctrl:opMode:sManual") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/0 T=BYTE B=1")
  field(ONAM, "Manual Mode")
  field(ZNAM, "Auto Mode")
  field(SCAN, "I/O Intr")
}

record(bo, "CM-Ctrl:Grafcet:cmdInit") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/0 T=BYTE B=4")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Init Grafcet")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}

record(bo, "CM-Ctrl:Grafcet:cmdErrRst") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/0 T=BYTE B=5")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Reset Grafcet Error")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bi, "CM-Ctrl:Grafcet:sErr") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/0 T=BYTE B=2")
  field(ONAM, "Grafcet Error")
  field(ZNAM, "Grafcet OK")
  field(SCAN, "I/O Intr")
}

record(bi, "CM-Ctrl:Grafcet:sState1") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/0 T=BYTE B=3")
  field(ONAM, "S1")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:Grafcet:sState2") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/0 T=BYTE B=4")
  field(ONAM, "S2")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:Grafcet:sState3") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/0 T=BYTE B=5")
  field(ONAM, "S3")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:Grafcet:sState4") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/0 T=BYTE B=6")
  field(ONAM, "S4")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:Grafcet:sState5") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/0 T=BYTE B=7")
  field(ONAM, "S5")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:Grafcet:sState6") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1 T=BYTE B=0")
  field(ONAM, "S6")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:Grafcet:sState7") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1 T=BYTE B=1")
  field(ONAM, "S7")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:Grafcet:sState8") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1 T=BYTE B=2")
  field(ONAM, "S8")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:Grafcet:sState10") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1 T=BYTE B=3")
  field(ONAM, "S10")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}

record(bi, "CM-Ctrl:Grafcet:sTransTempOK") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1 T=BYTE B=4")
  field(ONAM, "Transition temp. OK")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:Grafcet:sTransMode4K") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1 T=BYTE B=5")
  field(ONAM, "PIDs active CV02 & CV03")
  field(ZNAM, "")
  field(SCAN, "I/O Intr")
}

record(bi, "CM-Ctrl:CV550:sRegOn") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1 T=BYTE B=6")
  field(ONAM, "PID (analog) On")
  field(ZNAM, "PID (analog) Off")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:CV60:sRegOn") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1 T=BYTE B=7")
  field(ONAM, "PID On")
  field(ZNAM, "PID Off")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:CV01:sRegOn") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/2 T=BYTE B=0")
  field(ONAM, "PID On")
  field(ZNAM, "PID Off")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:CV02:sRegOn") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/2 T=BYTE B=1")
  field(ONAM, "PID On")
  field(ZNAM, "PID Off")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:CV03:sRegOn") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/2 T=BYTE B=2")
  field(ONAM, "PID On")
  field(ZNAM, "PID Off")
  field(SCAN, "I/O Intr")
}

record(bi, "CM-Ctrl:EpicsCom:sOK") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/2 T=BYTE B=3")
  field(ONAM, "OK")
  field(ZNAM, "Fault")
  field(ZSV, "MAJOR")
  field(SCAN, "I/O Intr")
}
record(bi, "CM-Ctrl:HNOSSCom:sOK") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/2 T=BYTE B=4")
  field(ONAM, "OK")
  field(ZNAM, "Fault")
  field(ZSV, "MAJOR")
  field(SCAN, "I/O Intr")
}

record(bi, "CM-Ctrl:CV5202:sOpenReq") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/2 T=BYTE B=5")
  field(ONAM, "Request to open")
  field(ZNAM, "Request to close")
  field(SCAN, "I/O Intr")
}

record(bo, "CM-Ctrl:Grafcet:cmdStart") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/0 T=BYTE B=6")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step2")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:Grafcet:cmdCondOK") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/0 T=BYTE B=7")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step3")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:Grafcet:cmdCondErr") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/1 T=BYTE B=0")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step1")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:Grafcet:cmdStartLN2Cool") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/1 T=BYTE B=1")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step4")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:Grafcet:cmdStartLHeCool") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/1 T=BYTE B=2")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step5")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:Grafcet:cmdStart2KMode") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/1 T=BYTE B=3")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step8")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:Grafcet:cmdStop2KMode") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/1 T=BYTE B=4")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step6")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:Grafcet:cmdStartStby") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/1 T=BYTE B=5")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step7")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:Grafcet:cmdStopStby") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/1 T=BYTE B=6")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step5")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:Grafcet:cmdStartHeating") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/1 T=BYTE B=7")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step10")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:Grafcet:cmdStopHeating") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/2 T=BYTE B=0")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Goto Step1")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:opMode:cmdSetAck") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/2 T=BYTE B=1")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Ackn Alarms")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:CV04:cmdRegOn") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/2 T=BYTE B=2")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Set PID")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:CV04:cmdRegOff") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/2 T=BYTE B=3")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "Reset PID")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bi, "CM-Ctrl:CV04:sRegOn") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/2 T=BYTE B=6")
  field(ONAM, "PID On")
  field(ZNAM, "PID Off")
  field(SCAN, "I/O Intr")
}

record(bo, "CM-Ctrl:LT:cmdSelLT01") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/2 T=BYTE B=4")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "LT01 for process Ctrl")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bo, "CM-Ctrl:LT:cmdSelLT02") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/2 T=BYTE B=5")
  field(HIGH, "0.5")
  field(UDFS, "NO_ALARM")
  field(ONAM, "LT02 for process Ctrl")
  field(ZNAM, "")
  field(SDIS, "CM-Ctrl:opMode:sLocal")
}
record(bi, "CM-Ctrl:LTforCtrl:sLT02") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/2 T=BYTE B=7")
  field(ONAM, "Using LT02")
  field(ZNAM, "Using LT01")
  field(SCAN, "I/O Intr")
}

###########################################################
#
# Analog inputs
#
record(ai, "CM-VBox:PT60:sRdV") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/892 T=FLOAT")
  field(PREC, "3")
  field(PINI, "YES")
  field(SCAN, "I/O Intr")
  field(EGU, "mbar")
}

record(ai, "CM-VBox:PT01:sRdV") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/896 T=FLOAT")
  field(PREC, "1")
  field(PINI, "YES")
  field(SCAN, "I/O Intr")
  field(EGU, "mbar")
}
record(ai, "CM-Vac:PT73:sRdV") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/900 T=FLOAT")
  field(PREC, "2")
  field(PINI, "YES")
  field(SCAN, "I/O Intr")
  field(EGU, "mbar")
}
record(ai, "CM-Vac:PT71:sRdV") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/904 T=FLOAT")
  field(PREC, "2")
  field(PINI, "YES")
  field(SCAN, "I/O Intr")
  field(EGU, "mbar")
}
record(ai, "CM-Vac:PT75:sRdV") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/908 T=FLOAT")
  field(PREC, "3")
  field(PINI, "YES")
  field(SCAN, "I/O Intr")
  field(EGU, "mbar")
}
record(ai, "CM-Vac:PT77:sRdV") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/912 T=FLOAT")
  field(PREC, "3")
  field(PINI, "YES")
  field(SCAN, "I/O Intr")
  field(EGU, "mbar")
}

record(ai, "CM-LHe:PT04:sRdV") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/952 T=FLOAT")
  field(PREC, "3")
  field(PINI, "YES")
  field(SCAN, "I/O Intr")
  field(EGU, "mbar")
}

record(ai, "CM-CM:PT02-direct:sRdV") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1116 T=FLOAT")
  field(PREC, "1")
  field(PINI, "YES")
  field(SCAN, "I/O Intr")
  field(EGU, "mbar")
}

############################################################
# Copy the Heart Beat from the PLC
############################################################
record(longin, "CM-Ctrl:HeartBeat:sRdV") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM_K/0 T=WORD")
  field(PINI, "YES")
  field(SCAN, "I/O Intr")
}

record(longout, "CM-Ctrl:HeartBeat:cSetV") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM_K/0 T=WORD")
  field(PINI, "NO")
  field(OMSL, "closed_loop")
  field(SCAN, "10 second")
  field(DOL, "CM-Ctrl:HeartBeat:sRdV")
}

############################################################
# Data from Keithley
############################################################

# Fix it - select the right gauges !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

record(ao, "CM-Ctrl:TTxx") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/4 T=FLOAT")
  field(PINI, "NO")
  field(PREC, "6")
  field(OMSL, "closed_loop")
  field(SCAN, "Event")
  field(EVNT, "$(SCAN_EVNT)")
  field(PHAS,"1")
  field(DOL, "CM-VBox:TT610:sRdV")
}

record(ao, "CM-Ctrl:TTyy") {
  field(DTYP, "S7plc")
  field(OUT, "@PLC:CM/4 T=FLOAT")
  field(PINI, "NO")
  field(PREC, "6")
  field(OMSL, "closed_loop")
  field(SCAN, "Event")
  field(EVNT, "$(SCAN_EVNT)")
  field(PHAS,"1")
  field(DOL, "CM-VBox:TT620:sRdV")
}

############################################################
# Grafcet steps
############################################################

record (mbbi, "CM-Ctrl:S4:sStep") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1020 T=BYTE")
  field(SCAN, "I/O Intr")
  field(PINI, "YES")
  field(NOBT, "8")
  field (SHFT, "0")
  field (ZRST, "Idle")
}
record (mbbi, "CM-Ctrl:S5:sStep") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1021 T=BYTE")
  field(SCAN, "I/O Intr")
  field(PINI, "YES")
  field(NOBT, "8")
  field (SHFT, "0")
  field (ZRST, "Idle")
  field (ONVL, "4")
  field (ONST, "Setting-up valves")
  field (TWVL, "6")
  field (TWST, "Filling 2K tank...")
  field (THVL, "8")
  field (THST, "Filling 4K tank...")
}
record (mbbi, "CM-Ctrl:S6:sStep") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1022 T=BYTE")
  field(SCAN, "I/O Intr")
  field(PINI, "YES")
  field(NOBT, "8")
  field (SHFT, "0")
  field (ZRST, "Idle")
}
record (mbbi, "CM-Ctrl:S7:sStep") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1023 T=BYTE")
  field(SCAN, "I/O Intr")
  field(PINI, "YES")
  field(NOBT, "8")
  field (SHFT, "0")
  field (ZRST, "Idle")
  field (ONVL, "4")
  field (ONST, "Setting-up valves")
  field (TWVL, "6")
  field (TWST, "Outgasing LHe...")
  field (THVL, "8")
  field (THST, "Passive warm-up...")
  field (FRVL, "10")
  field (FRST, "Cool-down...")
}
record (mbbi, "CM-Ctrl:S8:sStep") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1024 T=BYTE")
  field(SCAN, "I/O Intr")
  field(PINI, "YES")
  field(NOBT, "8")
  field (SHFT, "0")
  field (ZRST, "Idle")
  field (ONVL, "4")
  field (ONST, "Precooling 2K line...")
  field (TWVL, "6")
  field (TWST, "2K operation...")
  field (THVL, "8")
  field (THST, "Stopping...")
  field (FRVL, "7")
  field (FRST, "Transition to 4K...")
}
record (mbbi, "CM-Ctrl:S9:sStep") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1025 T=BYTE")
  field(SCAN, "I/O Intr")
  field(PINI, "YES")
  field(NOBT, "8")
  field (SHFT, "0")
  field (ZRST, "Idle")
}
record (mbbi, "CM-Ctrl:S10:sStep") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1026 T=BYTE")
  field(SCAN, "I/O Intr")
  field(PINI, "YES")
  field(NOBT, "8")
  field (SHFT, "0")
  field (ZRST, "Idle")
  field (ONVL, "4")
  field (ONST, "Closing CV5202 & FV401...")
  field (TWVL, "6")
  field (TWST, "Emptying 4K tank...")
  field (THVL, "8")
  field (THST, "Emptying the CM...")
  field (FRVL, "10")
  field (FRST, "Heating-up...")
}
record (mbbi, "CM-Ctrl:SX:sStep") {
  field(DTYP, "S7plc")
  field(INP, "@PLC:CM/1027 T=BYTE")
  field(SCAN, "I/O Intr")
  field(PINI, "YES")
  field(NOBT, "8")
  field (SHFT, "0")
  field (ZRST, " ")
}

record (calc, "CM-Ctrl:Grafcet:sStateNum") {
  field (SCAN, "1 second")
  field (INPA, "CM-Ctrl:Grafcet:sState1.VAL")
  field (INPB, "CM-Ctrl:Grafcet:sState2.VAL")
  field (INPC, "CM-Ctrl:Grafcet:sState3.VAL")
  field (INPD, "CM-Ctrl:Grafcet:sState4.VAL")
  field (INPE, "CM-Ctrl:Grafcet:sState5.VAL")
  field (INPF, "CM-Ctrl:Grafcet:sState6.VAL")
  field (INPG, "CM-Ctrl:Grafcet:sState7.VAL")
  field (INPH, "CM-Ctrl:Grafcet:sState8.VAL")
  field (INPJ, "CM-Ctrl:Grafcet:sState10.VAL")
  field (CALC, "A+B*2+C*3+D*4+E*5+F*6+G*7+H*8+J*10")
  field (FLNK, "CM-Ctrl:Grafcet:sStateStr")
}

record (mbbi, "CM-Ctrl:Grafcet:sStateStr") {
  field (DTYP, "Raw Soft Channel")
  field (INP, "CM-Ctrl:Grafcet:sStateNum")
  field (NOBT, "8")
  field (SHFT, "0")
  field (ZRST, "INVALID")
  field (ZRSV, "INVALID")
  field (ONVL, "1")
  field (ONST, "Initial State")
  field (TWVL, "2")
  field (TWST, "Conditioning")
  field (THVL, "3")
  field (THST, "Pausing")
  field (FRVL, "4")
  field (FRST, "LN2 Cooling")
  field (FVVL, "5")
  field (FVST, "LHe Cooling")
  field (SXVL, "6")
  field (SXST, "4K Operation")
  field (SVVL, "7")
  field (SVST, "Stand-by")
  field (EIVL, "8")
  field (EIST, "2K Operation")
  field (NIVL, "10")
  field (NIST, "Warm-up")
}

# Records for the alarm manager

record(calcout, "CM-CM:LT01:cLLSV") {
  field(INPA, "CM-Ctrl:S10:sStep.RVAL")
  field(INPB, "CM-Ctrl:S5:sStep.RVAL")
  field(INPC, "CM-Ctrl:Grafcet:sState5")
  field(INPD, "CM-Ctrl:Grafcet:sState6")
  field(INPE, "CM-Ctrl:Grafcet:sState8")
  field(INPF, "CM-Ctrl:Grafcet:sState10")
  field(CALC, "(C&&(B>6))||D||E||(F&&(A<8))?2:0")
  field(OUT, "CM-CM:LT01:sRdV.LLSV")
  field(SCAN, "1 second")
}

record(calcout, "CM-VBox:LT03:cLLSV") {
  field(INPA, "CM-Ctrl:S10:sStep.RVAL")
  field(INPD, "CM-Ctrl:Grafcet:sState6")
  field(INPE, "CM-Ctrl:Grafcet:sState8")
  field(INPF, "CM-Ctrl:Grafcet:sState10")
  field(CALC, "D||E||(F&&(A<6))?2:0")
  field(OUT, "CM-VBox:LT03:sRdV.LLSV")
  field(SCAN, "1 second")
}
